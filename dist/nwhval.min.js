const lang={en:{required:"This field is required",email:"This field requires a valid e-mail address",number:"This field requires a number",integer:"This field requires an integer value",url:"This field requires a valid website URL",tel:"This field requires a valid telephone number",maxlength:"This fields length must be < ${1}",minlength:"This fields length must be > ${1}",min:"Minimum value for this field is ${1}",max:"Maximum value for this field is ${1}",pattern:"Please match the requested format"},fr:{required:"Ce champ est obligatoire",email:"Ce champ requiert une adresse e-mail valide",number:"Ce champ requiert un nombre",integer:"Ce champ requiert un nombre entier",url:"Ce champ requiert une URL valide",tel:"Ce champ requiert un numéro de téléphone valide",maxlength:"La longueur de ce champ doit être < ${1}",minlength:"La longueur de ce champ doit être > ${1}",min:"La valeur minimum pour ce champ est ${1}",max:"La valeur maximum pour ce champ est ${1}",pattern:"Veuillez respecter le format requis"},es:{required:"Este campo es obligatorio",email:"Este campo requiere una dirección de correo electrónico válida",number:"Este campo requiere un número",integer:"Este campo requiere un número entero",url:"Este campo requiere una URL válida",tel:"Este campo requiere un número de teléfono válido",maxlength:"La longitud de este campo debe ser < ${1}",minlength:"La longitud de este campo debe ser > ${1}",min:"El valor mínimo para este campo es ${1}",max:"El valor máximo para este campo es ${1}",pattern:"Por favor, respeta el formato requerido"}};function findAncestor(e){return e.parentNode}function tmpl(){return this.replace(/\${([^{}]*)}/g,(e,t)=>arguments[t])}function groupedElemCount(e){return e.nwhval.self.form.querySelectorAll('input[name="'+e.getAttribute("name")+'"]:checked').length}function mergeConfig(e,t){for(var r in t)r in e||(e[r]=t[r]);return e}function isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}function insertAfter(e,t){t.parentNode.insertBefore(e,t.nextSibling)}class Validator{constructor(e,t){void 0===t.styling?this.defaultConfig={styling:"bootstrap-5",classTo:"form-group",errorClass:"is-invalid",successClass:"is-valid",errorTextParent:"form-group",errorTextClass:"invalid-feedback",errorTextTag:"div",live:!0,lang:"en"}:"bootstrap-4"===t.styling&&(this.defaultConfig={styling:"bootstrap-4",classTo:"form-group",errorClass:"has-danger",successClass:"has-success",errorTextParent:"form-group",errorTextClass:"text-help",errorTextTag:"div",live:!0,lang:"en"}),this.form=e,this.config=mergeConfig(t||{},this.defaultConfig),this.NWHVAL_ERROR="nwhval-error";const l=["required","min","max","minlength","maxlength","pattern"],r=/^[a-zA-Z0-9.! #$%&'*+/=? ^_`{|}~-]+@[a-zA-Z0-9-]+(?:\. [a-zA-Z0-9-]+)*$/,o=/-message(?:-([a-z]{2}(?:_[A-Z]{2})?))?/;this.validators={},this._setValidator("text",{fn:()=>!0,priority:0},this.config.lang),this._setValidator("required",{fn:function(e){return"radio"===this.type||"checkbox"===this.type?groupedElemCount(this):void 0!==e&&""!==e},priority:99,halt:!0},this.config.lang),this._setValidator("email",{fn:e=>!e||r.test(e)},this.config.lang),this._setValidator("number",{fn:e=>!e||!isNaN(parseFloat(e)),priority:2},this.config.lang),this._setValidator("integer",{fn:e=>!e||/^\d+$/.test(e)},this.config.lang),this._setValidator("minlength",{fn:(e,t)=>!e||e.length>=parseInt(t)},this.config.lang),this._setValidator("maxlength",{fn:(e,t)=>!e||e.length<=parseInt(t)},this.config.lang),this._setValidator("min",{fn:function(e,t){return!e||("checkbox"===this.type?groupedElemCount(this)>=parseInt(t):parseFloat(e)>=parseFloat(t))}},this.config.lang),this._setValidator("max",{fn:function(e,t){return!e||("checkbox"===this.type?groupedElemCount(this)<=parseInt(t):parseFloat(e)<=parseFloat(t))}},this.config.lang),this._setValidator("pattern",{fn:(e,t)=>{t=t.match(new RegExp("^/(.*?)/([gimy]*)$"));return!e||new RegExp(t[1],t[2]).test(e)}},this.config.lang),e.setAttribute("novalidate","true");let u=this;const i=e.querySelectorAll("input:not([type^=hidden]):not([type^=submit]), select, textarea");this.fields=Array.from(i).map(function(e){let s=[],a={},n={};return[].forEach.call(e.attributes,function(t){if(/^data-pristine-/.test(t.name)){let e=t.name.substr(14);var r,i=e.match(o);null!==i?(r=void 0===i[1]?"en":i[1],n.hasOwnProperty.call(r)||(n[r]={}),n[r][e.slice(0,e.length-i[0].length)]=t.value):("type"===e&&(e=t.value),u._addValidatorToField(s,a,e,t.value))}else~l.indexOf(t.name)?u._addValidatorToField(s,a,t.name,t.value):"type"===t.name&&u._addValidatorToField(s,a,t.value)}),s.sort((e,t)=>t.priority-e.priority),e.pristine={input:e,validators:s,params:a,messages:n,self:u}}.bind(u));for(let e=0;e<i.length;e++)"radio"===i[e].getAttribute("type")||"checkbox"===i[e].getAttribute("type")?i[e].addEventListener("change",function(e){u.validate(e.target)}):i[e].addEventListener("input",function(e){u.validate(e.target)})}_setValidator(e,t,r){t.name=e,t.msg||(t.msg=lang[r][e]),void 0===t.priority&&(t.priority=1),this.validators[e]=t}_addValidatorToField(e,t,r,i){var s=this.validators[r];if(s&&(e.push(s),i)){let e=i.split(",");e.unshift(null),t[r]=e}}validate(i,s){if(void 0===i){s=i&&!0===s||!0===i;let t=this.fields,r=(!0!==i&&!1!==i&&(i instanceof HTMLElement?t=[i.pristine]:(i instanceof NodeList||i instanceof(window.$||Array)||i instanceof Array)&&(t=Array.from(i).map(e=>e.pristine))),!0);for(let e=0;t[e];e++){var a=t[e];this._validateField(a)?s||this._showSuccess(a):(r=!1,s||this._showError(a))}return r}var e;"INPUT"!==i.nodeName&&"SELECT"!==i.nodeName&&"TEXTAREA"!==i.nodeName||(e=this.fields.find(e=>e.input===i),this._validateField(e)?s||this._showSuccess(e):s||this._showError(e))}getErrors(e){if(e)return((!e.tagName||"select"!==e.tagName.toLowerCase())&&e.length?e[0]:e).nwhval.errors;{let t=[];for(let e=0;e<this.fields.length;e++){var r=this.fields[e];r.errors.length&&t.push({input:r.input,errors:r.errors})}return t}}_validateField(i){let s=[],a=!0;for(let r=0;i.validators[r];r++){let e=i.validators[r],t=i.params[e.name]||[];var n;if(t[0]=i.input.value,!e.fn.apply(i.input,t))if(a=!1,isFunction(e.msg)?s.push(e.msg(i.input.value,t)):(n=i.messages[e.name]||e.msg,s.push(tmpl.apply(n,t))),!0===e.halt)break}return i.errors=s,a}_getErrorElements(e){if(e.errorElements)return e.errorElements;let t=findAncestor(e.input,this.config.classTo),r=null,i=null;return(r=this.config.classTo===this.config.errorTextParent?t:t.querySelector("."+this.config.errorTextParent))&&!(i=r.querySelector("."+this.NWHVAL_ERROR))&&((i=document.createElement(this.config.errorTextTag)).className=this.NWHVAL_ERROR+" "+this.config.errorTextClass,insertAfter(i,e.input),i.nwhvalDisplay=i.style.display),e.errorElements=[t,i]}_showError(t){var e=this._getErrorElements(t);let r=e[0],i=e[1];if(r){r.classList.remove(this.config.successClass),r.classList.add(this.config.errorClass);let e=t.input;e&&e.classList.add(this.config.errorClass)}i&&(i.innerHTML=t.errors.join("<br/>"),i.style.display=i.nwhvalDisplay||"")}addError(e,t){(e=e.length?e[0]:e).nwhval.errors.push(t),this._showError(e.nwhval)}_removeError(t){var e=this._getErrorElements(t);let r=e[0],i=e[1];if(r){r.classList.remove(this.config.errorClass),r.classList.remove(this.config.successClass);let e=t.input;e&&(e.classList.remove(this.config.errorClass),e.classList.remove(this.config.successClass))}return i&&(i.innerHTML="",i.style.display="none"),e}_showSuccess(e){let t=this._removeError(e)[0],r=(t&&t.classList.add(this.config.successClass),t.querySelector("input"));r&&r.classList.add(this.config.successClass)}reset(){for(let e=0;this.fields[e];e++)this.fields[e].errorElements=null;Array.from(this.form.querySelectorAll("."+this.NWHVAL_ERROR)).map(function(e){e.parentNode.removeChild(e)}),Array.from(this.form.querySelectorAll("."+this.config.classTo)).map(function(e){e.classList.remove(this.config.successClass),e.classList.remove(this.config.errorClass)})}destroy(){this.reset(),this.fields.forEach(function(e){delete e.input.nwhval}),this.fields=[]}setGlobalConfig(e){this.defaultConfig=e}addValidator(e,t,r,i,s){e instanceof HTMLElement?(e.nwhval.validators.push({fn:t,msg:r,priority:i,halt:s}),e.nwhval.validators.sort((e,t)=>t.priority-e.priority)):this._setValidator(name,{fn:t,msg:r,priority:i,halt:s})}}export{Validator as default};
